<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="学会学习的人，是幸福的人"><title>Redux入门指南 | Hi, MrGong</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=2.0.1"><link rel="stylesheet" type="text/css" href="/css/highlight.css?v=2.0.1"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Redux入门指南</h1><a id="logo" href="/.">Hi, MrGong</a><p class="description"></p></div><div id="nav-menu"> <a href="/." class="current"><i class="fa fa-home">首页</i></a> <a href="/archives/"><i class="fa fa-archive">归档</i></a> <a href="/about/"><i class="fa fa-user">关于</i></a></div><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="Arama"></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">Redux入门指南</h1><div class="post-meta"><a href="/2018/08/12/Redux入门指南/#comments" class="comment-count"></a><p><span class="date">Aug 12, 2018</span><span><a href="/categories/React/" class="category">React</a></span><span><i id="busuanzi_container_page_pv"><i id="busuanzi_value_page_pv"></i><i>点击</i></i></span></p></div><div class="post-content"><h2 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">为了方便讲解，我写了一个Demo，请先安装一下</span><br><span class="line">$ git <span class="built_in">clone</span> https://github.com/GYunZhi/cnode.git</span><br><span class="line">$ <span class="built_in">cd</span> cnode &amp;&amp; yarn</span><br><span class="line">$ yarn start</span><br></pre></td></tr></table></figure><h2 id="一、三大原则"><a href="#一、三大原则" class="headerlink" title="一、三大原则"></a>一、三大原则</h2><p><strong>Redux 可以用这三个基本原则来描述：</strong></p><h4 id="单一数据源"><a href="#单一数据源" class="headerlink" title="单一数据源"></a>单一数据源</h4><p><strong>整个应用的 state 被储存在一棵 object tree 中，并且这个 object tree 只存在于唯一一个 store 中。</strong></p><p>这让同构应用开发变得非常容易。来自服务端的 state 可以在无需编写更多代码的情况下被序列化并注入到客户端中。由于是单一的 state tree ，调试也变得非常容易。在开发中，你可以把应用的 state 保存在本地，从而加快开发速度。此外，受益于单一的 state tree ，以前难以实现的如“撤销/重做”这类功能也变得轻而易举。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(store.getState())</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 输出</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">  visibilityFilter: 'SHOW_ALL',</span></span><br><span class="line"><span class="comment">  todos: [</span></span><br><span class="line"><span class="comment">    &#123;</span></span><br><span class="line"><span class="comment">      text: 'Consider using Redux',</span></span><br><span class="line"><span class="comment">      completed: true,</span></span><br><span class="line"><span class="comment">    &#125;,</span></span><br><span class="line"><span class="comment">    &#123;</span></span><br><span class="line"><span class="comment">      text: 'Keep all state in a single tree',</span></span><br><span class="line"><span class="comment">      completed: false</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">  ]</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*／</span></span><br></pre></td></tr></table></figure><h4 id="State-是只读的"><a href="#State-是只读的" class="headerlink" title="State 是只读的"></a>State 是只读的</h4><p><strong>唯一改变 state 的方法就是触发 action，action 是一个用于描述已发生事件的普通对象。</strong></p><p>这样确保了视图和网络请求都不能直接修改 state，相反它们只能表达想要修改的意图。因为所有的修改都被集中化处理，且严格按照一个接一个的顺序执行，因此不用担心 race condition 的出现。 Action 就是普通对象而已，因此它们可以被日志打印、序列化、储存、后期调试或测试时回放出来。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">store.dispatch(&#123;</span><br><span class="line">  type: <span class="string">'COMPLETE_TODO'</span>,</span><br><span class="line">  index: <span class="number">1</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">store.dispatch(&#123;</span><br><span class="line">  type: <span class="string">'SET_VISIBILITY_FILTER'</span>,</span><br><span class="line">  filter: <span class="string">'SHOW_COMPLETED'</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="使用纯函数来执行修改"><a href="#使用纯函数来执行修改" class="headerlink" title="使用纯函数来执行修改"></a>使用纯函数来执行修改</h4><p><strong>为了描述 action 如何改变 state tree ，你需要编写 reducers。</strong></p><p>Reducer 只是一些纯函数，它接收先前的 state 和 action，并返回新的 state。刚开始你可以只有一个 reducer，随着应用变大，你可以把它拆成多个小的 reducers，分别独立地操作 state tree 的不同部分，因为 reducer 只是函数，你可以控制它们被调用的顺序，传入附加数据，甚至编写可复用的 reducer 来处理一些通用任务，如分页器。<code></code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">visibilityFilter</span>(<span class="params">state = <span class="string">'SHOW_ALL'</span>, action</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'SET_VISIBILITY_FILTER'</span>:</span><br><span class="line">      <span class="keyword">return</span> action.filter</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">return</span> state</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">todos</span>(<span class="params">state = [], action</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'ADD_TODO'</span>:</span><br><span class="line">      <span class="keyword">return</span> [</span><br><span class="line">        ...state,</span><br><span class="line">        &#123;</span><br><span class="line">          text: action.text,</span><br><span class="line">          completed: <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'COMPLETE_TODO'</span>:</span><br><span class="line">      <span class="keyword">return</span> state.map(<span class="function">(<span class="params">todo, index</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (index === action.index) &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="built_in">Object</span>.assign(&#123;&#125;, todo, &#123;</span><br><span class="line">            completed: <span class="literal">true</span></span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> todo</span><br><span class="line">      &#125;)</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">return</span> state</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">import</span> &#123; combineReducers, createStore &#125; <span class="keyword">from</span> <span class="string">'redux'</span></span><br><span class="line"><span class="keyword">let</span> reducer = combineReducers(&#123; visibilityFilter, todos &#125;)</span><br><span class="line"><span class="keyword">let</span> store = createStore(reducer)</span><br></pre></td></tr></table></figure><p>就是这样，现在你应该明白 Redux 是怎么回事了。</p><h2 id="二、基本概念"><a href="#二、基本概念" class="headerlink" title="二、基本概念"></a>二、基本概念</h2><p>redux中有三个基本概念，Action，Reducer，Store。</p><h4 id="Action"><a href="#Action" class="headerlink" title="Action"></a>Action</h4><p><strong>官方的介绍：</strong></p><p>Actions are payloads of information that send data from your application to your store. They are the only source of information for the store. You send them to the store using store.dispatch().</p><p><strong>中文：</strong></p><p>Actions 是把数据从应用传到 store 的有效载荷。它是 store 数据的唯一来源。用法是通过 store.dispatch() 把 action 传到 store。</p><p><strong>总结：</strong></p><p>Action 有两个作用。</p><ol><li>用Action来分辨具体的执行动作。比如是create ?还是delete？或者是update？</li><li>操作数据首先得有数据。比如添加数据得有数据，删除数据得有ID,action携带了这些数据。</li></ol><h4 id="Reducer"><a href="#Reducer" class="headerlink" title="Reducer"></a>Reducer</h4><p><strong>官方的介绍：</strong></p><p>Actions describe the fact that something happened, but don’t specify how the application’s state changes in response. This is the job of a reducer.</p><p><strong>中文：</strong></p><p>Action 只是描述了有事情发生了这一事实，并没有指明应用如何更新 state。这是 reducer 要做的事情。</p><p><strong>总结：</strong></p><p>Action就像leader，告诉我们应该做哪些事，并且提供数据，真正干活的是苦逼的Reducer。</p><h4 id="Store"><a href="#Store" class="headerlink" title="Store"></a>Store</h4><p>一个应用只有一个Store。一个应用只有一个Store。一个应用只有一个Store。</p><p>重要的事情放在前面说，而且说三遍。</p><p><strong>官方的介绍：</strong></p><p>In the previous sections, we defined the actions that represent the facts about “what happened” and the reducers that update the state according to those actions.</p><p>The Store is the object that brings them together. The store has the following responsibilities:</p><ul><li>Holds application state;</li><li>Allows access to state via getState();</li><li>Allows state to be updated via dispatch(action);</li><li>Registers listeners via subscribe(listener).</li></ul><p><strong>翻译成中文：</strong></p><p>上面章节中，我们学会了使用 action 来描述“发生了什么”，和使用 reducers 来根据 action 更新 state 的用法。</p><p>Store 就是把它们联系到一起的对象。Store 有以下职责：</p><ul><li>保存应用的 state；</li><li>提供 getState() 方法获取 state；</li><li>提供 dispatch(action) 方法更新 state；</li><li>通过 subscribe(listener) 注册监听器。</li></ul><p><strong>总结：</strong></p><p>Store提供了一些方法。让我们很方便的操作数据。</p><p>我们不用关心Reducer和Action是怎么关联在一起的，Store已经帮我们做了这些事</p><h4 id="Redux-流程图"><a href="#Redux-流程图" class="headerlink" title="Redux 流程图"></a>Redux 流程图</h4><p><img src="https://camo.githubusercontent.com/76224d874f32535aa62c0cd01750fb71fb02cf53/687474703a2f2f70362e7168696d672e636f6d2f642f696e6e2f39613331326463632f7265647578466c6f772e706e67" alt="流程图"></p><h2 id="三、详细介绍"><a href="#三、详细介绍" class="headerlink" title="三、详细介绍"></a>三、详细介绍</h2><p>这部分主要讲解redux如何在项目中使用。</p><h4 id="Action-1"><a href="#Action-1" class="headerlink" title="Action"></a>Action</h4><p>Action 是一个普通对象。</p><p>redux约定 Action 内使用一个字符串类型的 <code>type</code> 字段来表示将要执行的动作。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  type: <span class="string">'ADD_ITEM'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>除了 <code>type</code> 之外，Action可以存放一些其他的想要操作的数据。例如：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  type: <span class="string">'ADD_ITEM'</span>,</span><br><span class="line">  text: <span class="string">'我是Berwin'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上面例子表示</p><ol><li>我要创建一条数据</li><li>创建的数据为大概是这样的</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  text: <span class="string">'我是Berwin'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>但在实际应用中，我们需要一个函数来为我们创建Action。这个函数叫做actionCreator。它看起来是这样的：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addItem</span>(<span class="params">text</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    type: types.ADD_ITEM,</span><br><span class="line">    text</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Reducer-1"><a href="#Reducer-1" class="headerlink" title="Reducer"></a>Reducer</h4><p>Reducer 是一个普通的回调函数，其函数签名为reducer(previousState, action)。</p><p>当它被Redux调用的时候会为他传递两个参数<code>State</code> 和 <code>Action</code>。</p><p>Reducer会根据 <code>Action</code> 的type来对旧的 <code>State</code> 进行操作,返回新的State。</p><p>看起来是下面这样的：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> action = &#123;</span><br><span class="line">  type: <span class="string">'ADD_TODO'</span>,</span><br><span class="line">  text: <span class="string">'Learn Redux'</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>Reducer很简单，但有三点需要注意</p><ol><li>不要修改 <code>state</code>。</li><li>在 default 情况下返回旧的 state。遇到未知的 action 时，一定要返回旧的 state。</li><li>如果没有旧的State，就返回一个initialState，这很重要！！！</li></ol><p><strong>这是一部分核心源码：</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// currentState 是当前的State，currentReducer 是当前的Reducer</span></span><br><span class="line">currentState = currentReducer(currentState, action);</span><br></pre></td></tr></table></figure><p>如果在default或没有传入旧State的情况下不返回旧的State或initialState,那么当前的State会被重置为undefined！！</p><p>在使用combineReducers方法时，它也会检测你的函数写的是否标准。如果不标准，那么会抛出一个大大的错误！！</p><p><strong>combineReducers</strong></p><p>真正开发项目的时候<code>State</code>会涉及很多功能，在一个<code>Reducer</code>处理所有逻辑会非常混乱，，所以需要拆分成多个小<code>Reducer</code>，每个<code>Reducer</code>只处理它管理的那部分State数据。然后在由一个主<code>rootReducers</code>来专门管理这些小<code>Reducer</code>。</p><p>Redux提供了一个方法 <code>combineReducers</code> 专门来管理这些小Reducer。</p><p>它看起来是下面这样：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 这是一个子Reducer</span></span><br><span class="line"><span class="comment"> * @param State</span></span><br><span class="line"><span class="comment"> * @param Action</span></span><br><span class="line"><span class="comment"> * @return new State</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">let</span> list = <span class="function">(<span class="params">state = [], action</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> ADD_ITEM:</span><br><span class="line">      <span class="keyword">return</span> [createItem(action.text), ...state]</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">return</span> state</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这是一个简单版的子Reducer，它什么都没有做。</span></span><br><span class="line"><span class="keyword">let</span> category = <span class="function">(<span class="params">state = &#123;&#125;, action</span>) =&gt;</span> state;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 这是一个主Reducer</span></span><br><span class="line"><span class="comment"> * @param State</span></span><br><span class="line"><span class="comment"> * @param Action</span></span><br><span class="line"><span class="comment"> * @return new State</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">let</span> rootReducers = combineReducers(&#123;list, category&#125;);</span><br></pre></td></tr></table></figure><p><code>combineReducers</code> 生成了一个类似于Reducer的函数。为什么是类似于，因为它不是真正的Reducer，它只是一个调用Reducer的函数，只不过它接收的参数与真正的Reducer一模一样~</p><p><strong>这是一部分核心源码：</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">combineReducers</span>(<span class="params">reducers</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 过滤reducers，把非function类型的过滤掉</span></span><br><span class="line">  <span class="keyword">var</span> finalReducers = pick(reducers, (val) =&gt; <span class="keyword">typeof</span> val === <span class="string">'function'</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 一开始我一直以为这个没啥用，后来我发现，这个函数太重要了。它在一开始，就已经把你的State改变了。变成了，Reducer的key 和 Reducer返回的initState组合。</span></span><br><span class="line">  <span class="keyword">var</span> defaultState = mapValues(finalReducers, () =&gt; <span class="literal">undefined</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">combination</span>(<span class="params">state = defaultState, action</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// finalReducers 是 reducers</span></span><br><span class="line">      <span class="keyword">var</span> finalState = mapValues(finalReducers, (reducer, key) =&gt; &#123;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// state[key] 是当前Reducer所对应的State，可以理解为当前的State</span></span><br><span class="line">      <span class="keyword">var</span> previousStateForKey = state[key];</span><br><span class="line">      <span class="keyword">var</span> nextStateForKey = reducer(previousStateForKey, action);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> nextStateForKey;      </span><br><span class="line">  &#125;);</span><br><span class="line">      <span class="comment">// finalState 是 Reducer的key和stat的组合。。</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>从上面的源码可以看出，combineReducers 生成一个类似于Reducer的函数<code>combination</code>。</p><p>当使用combination的时候，combination会把所有子Reducer都执行一遍，子Reducer通过action.type 匹配操作，因为是执行所有子Reducer，所以如果两个子Reducer匹配的action.type是一样的，那么都会成功匹配。</p><h4 id="Store-1"><a href="#Store-1" class="headerlink" title="Store"></a>Store</h4><p>上面已经介绍什么是Store，以及它是干什么的，这里我就讲讲如何创建Store，以及如何使用Store的方法。</p><p>创建Store非常简单。createStore 有两个参数，Reducer 和 initialState。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> store = createStore(rootReducers, initialState);</span><br></pre></td></tr></table></figure><p>store有四个方法。</p><ol><li>getState： 获取应用当前State。</li><li>subscribe：添加一个变化监听器。</li><li>dispatch：分发 action。修改State。</li><li>replaceReducer：替换 store 当前用来处理 state 的 reducer。</li></ol><p>常用的是dispatch，这是修改State的唯一途径，使用起来也非常简单，他看起来是这样的~</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 创建Action</span></span><br><span class="line"><span class="comment"> * @param 添加的数据</span></span><br><span class="line"><span class="comment"> * @return &#123;Object&#125; Action</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addItem</span>(<span class="params">text</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    type: types.ADD_ITEM,</span><br><span class="line">    text</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 新增数据</span></span><br><span class="line">store.dispatch(addItem(<span class="string">'Read the docs'</span>));</span><br></pre></td></tr></table></figure><p><strong>这是一部分核心源码：</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dispatch</span>(<span class="params">action</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// currentReducer 是当前的Reducer</span></span><br><span class="line">  currentState = currentReducer(currentState, action);</span><br><span class="line"></span><br><span class="line">  listeners.slice().forEach(<span class="function"><span class="keyword">function</span> (<span class="params">listener</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> listener();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> action;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以看到其实就是把当前的Reducer执行了。并且传入State和Action。</p><p>State哪来的？</p><p>State其实一直在Redux内部保存着。并且每次执行currentReducer都会更新。在上面代码第一行可以看到。</p><h2 id="四、React-Redux"><a href="#四、React-Redux" class="headerlink" title="四、React-Redux"></a>四、React-Redux</h2><p>Redux 是独立的，它与React没有任何关系。React-Redux是官方提供的一个库，用来结合redux和react的模块。</p><p>React-Redux提供了两个接口<code>Provider</code>、<code>connect</code>。</p><h4 id="Provider"><a href="#Provider" class="headerlink" title="Provider"></a>Provider</h4><p>Provider是一个React组件，它的作用是保存store给子组件中的connect使用。</p><ol><li>通过getChildContext方法把store保存到context里。</li><li>后面connect中会通过context读取store。</li></ol><p>它看起来是这个样子的：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;Provider store=&#123;<span class="keyword">this</span>.props.store&#125;&gt;</span><br><span class="line">  &lt;h1&gt;Hello World!<span class="xml"><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">&lt;<span class="regexp">/Provider&gt;</span></span><br></pre></td></tr></table></figure><p><strong>这是一部分核心源码：</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">getChildContext() &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123; <span class="attr">store</span>: <span class="keyword">this</span>.store &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">constructor</span>(props, context) &#123;</span><br><span class="line">  <span class="keyword">super</span>(props, context)</span><br><span class="line">  <span class="keyword">this</span>.store = props.store</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以看到，先获取store，然后用 getChildContext 把store保存起来~</p><h4 id="connect"><a href="#connect" class="headerlink" title="connect"></a>connect</h4><p>connect 会把State和dispatch转换成props传递给子组件。它看起来是下面这样的：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> actionCreators <span class="keyword">from</span> <span class="string">'./actionCreators'</span></span><br><span class="line"><span class="keyword">import</span> &#123; bindActionCreators &#125; <span class="keyword">from</span> <span class="string">'redux'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mapStateToProps</span>(<span class="params">state</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123; <span class="attr">todos</span>: state.todos &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mapDispatchToProps</span>(<span class="params">dispatch</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123; <span class="attr">actions</span>: bindActionCreators(actionCreators, dispatch) &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(mapStateToProps, mapDispatchToProps)(Component)</span><br></pre></td></tr></table></figure><p>它会让我们传递一些参数：mapStateToProps，mapDispatchToProps，mergeProps（可不填）和React组件。</p><p>之后这个方法会进行一系列的黑魔法，把state，dispatch转换成props传到React组件上，返回给我们使用。</p><p><strong>mapStateToProps：</strong></p><p>mapStateToProps 是一个普通的函数。</p><p>当它被connect调用的时候会为它传递一个参数State。</p><p>mapStateToProps需要负责的事情就是 返回需要传递给子组件的State，返回需要传递给子组件的State，返回需要传递给子组件的State，（重要的事情说三遍。。。。）然后connect会拿到返回的数据写入到react组件中，然后组件中就可以通过props读取数据啦~~~~</p><p>它看起来是这样的：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mapStateToProps</span>(<span class="params">state</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123; <span class="attr">list</span>: state.list &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>因为stat是全局State，里面包含整个项目的所有State，但是我不需要拿到所有State，我只拿到我需要的那部分State即可，所以需要返回 state.list 传递给组件</p><p><strong>mapDispatchToProps：</strong></p><p>与mapStateToProps很像，mapDispatchToProps也是一个普通的函数。</p><p>当它被connect调用的时候会为它传递一个参数dispatch。</p><p>mapDispatchToProps负责返回一个 <code>dispatchProps</code></p><p><code>dispatchProps</code> 是actionCreator的key和dispatch(action)的组合。</p><p><code>dispatchProps</code> 看起来长这样：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  addItem: <span class="function">(<span class="params">text</span>) =&gt;</span> dispatch(action)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>connect 收到这样的数据后，会把它放到React组件上。然后子组件就可以通过props拿到addItem并且使用啦。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.props.addItem(<span class="string">'Hello World~'</span>);</span><br></pre></td></tr></table></figure><p>如果觉得复杂，不好理解，，那我用大白话描述一下</p><p>就是通过mapDispatchToProps这个方法，把actionCreator变成方法赋值到props，每当调用这个方法，就会更新State。。。。额，，这么说应该好理解了。。</p><p><strong>bindActionCreators：</strong></p><p>但如果我有很多个Action，总不能手动一个一个加。Redux提供了一个方法叫 <code>bindActionCreators</code>。</p><p><code>bindActionCreators</code> 的作用就是将 <code>Actions</code> 和 <code>dispatch</code> 组合起来生成 <code>mapDispatchToProps</code> 需要生成的内容。</p><p>它看起来像这样：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> actions = &#123;</span><br><span class="line">  addItem: <span class="function">(<span class="params">text</span>) =&gt;</span> &#123;</span><br><span class="line">    type: types.ADD_ITEM,</span><br><span class="line">    text</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">bindActionCreators(actions, dispatch); <span class="comment">// @return &#123;addItem: (text) =&gt; dispatch(&#123; type: types.ADD_ITEM, text &#125;)&#125;</span></span><br></pre></td></tr></table></figure><p><strong>这是一部分核心源码：</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">function bindActionCreator(actionCreator, dispatch) &#123;</span><br><span class="line">  return (...args) =&gt; dispatch(actionCreator(...args));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// mapValues： map第一个参数的每一项，返回对象，key是key，value是第二个参数返回的数据</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line"> * mapValues： map第一个参数的每一项，返回对象，key是key，value是第二个参数返回的数据</span><br><span class="line"> * @param actionCreators</span><br><span class="line"> * @param dispatch</span><br><span class="line"> * @return &#123;actionKey: (...args) =&gt; dispatch(actionCreator(...args))&#125;</span><br><span class="line"> */</span><br><span class="line">export default function bindActionCreators(actionCreators, dispatch) &#123;</span><br><span class="line">  return mapValues(actionCreators, actionCreator =&gt;</span><br><span class="line">    bindActionCreator(actionCreator, dispatch)</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以看到，<code>bindActionCreators</code> 执行这个方法之后，它把 <code>actionCreators</code> 的每一项的 <code>key</code> 不变，<code>value</code> 变成 <code>dispatch(actionCreator(...args))</code> 这玩意，这表示，<code>actionCreator</code> 已经变成了一个可执行的方法，执行这个方法，就会执行 <code>dispatch</code> 更新数据。。</p><p><strong>加了React-Redux之后的流程图</strong></p><p><img src="https://camo.githubusercontent.com/1d3eb7f2982f8c6982a6e74f1dd6fbe872189845/687474703a2f2f70392e7168696d672e636f6d2f642f696e6e2f61386162336561342f72656163742d72656475782e706e67" alt="流程图"></p></div><div class="tags"><a href="/tags/React/">React</a></div><div class="post-share"></div><div class="post-nav"><a href="/2018/08/27/ECMAScript 6/" class="pre">ECMAScript 6</a><a href="/2018/08/05/跨文档消息通信/" class="next">跨文档消息通信</a></div><div id="comments"><div id="lv-container" data-id="city" data-uid="MTAyMC8zMzg4NC8xMDQzNw=="></div></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="search-pla"></div><div id="toc" class="widget"><div class="widget-title"><i class="fa fa-fei">文章目录</i></div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Demo"><span class="toc-text">Demo</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#一、三大原则"><span class="toc-text">一、三大原则</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#单一数据源"><span class="toc-text">单一数据源</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#State-是只读的"><span class="toc-text">State 是只读的</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#使用纯函数来执行修改"><span class="toc-text">使用纯函数来执行修改</span></a></li></ol></li></ol><li class="toc-item toc-level-2"><a class="toc-link" href="#二、基本概念"><span class="toc-text">二、基本概念</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Action"><span class="toc-text">Action</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Reducer"><span class="toc-text">Reducer</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Store"><span class="toc-text">Store</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Redux-流程图"><span class="toc-text">Redux 流程图</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#三、详细介绍"><span class="toc-text">三、详细介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Action-1"><span class="toc-text">Action</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Reducer-1"><span class="toc-text">Reducer</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Store-1"><span class="toc-text">Store</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#四、React-Redux"><span class="toc-text">四、React-Redux</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Provider"><span class="toc-text">Provider</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#connect"><span class="toc-text">connect</span></a></li></ol></li></div><div class="widget"><div class="widget-title"> <i class="fa fa-xie">最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/12/09/Express框架入门/">Express框架入门</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/11/Connect框架源码分析/">Connect框架源码分析</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/19/Node基础知识/">Node基础知识</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/06/Node、NPM安装/">Node、NPM安装</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/09/Javascript异步编程的演进/">Javascript异步编程的演进</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/08/27/ECMAScript 6/">ECMAScript 6</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/08/12/Redux入门指南/">Redux入门指南</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/08/05/跨文档消息通信/">跨文档消息通信</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/07/21/事件探究/">事件探究</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/07/16/Blob API的使用/">Blob API的使用</a></li></ul></div><div class="widget"><div class="widget-title"> <i class="fa fa-gui">分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Express/">Express</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Hexo/">Hexo</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/JavaScript/">JavaScript</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Node/">Node</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/React/">React</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/React-Native/">React-Native</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Web安全/">Web安全</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/服务器/">服务器</a><span class="category-list-count">3</span></li></ul></div><div class="widget"><div class="widget-title"> <i class="fa fa-biao">标签</i></div><div class="tagcloud"><a href="/tags/Linux/" style="font-size:15px">Linux</a> <a href="/tags/Express/" style="font-size:15px">Express</a> <a href="/tags/JavaScript/" style="font-size:15px">JavaScript</a> <a href="/tags/React-Native/" style="font-size:15px">React-Native</a> <a href="/tags/React/" style="font-size:15px">React</a> <a href="/tags/Node/" style="font-size:15px">Node</a> <a href="/tags/服务器/" style="font-size:15px">服务器</a> <a href="/tags/Hexo/" style="font-size:15px">Hexo</a> <a href="/tags/Web安全/" style="font-size:15px">Web安全</a></div></div><div class="widget"><div class="widget-title"> <i class="fa fa-archive">归档</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">十二月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">十一月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">十月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">九月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">八月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">七月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">六月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">四月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">三月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">二月 2018</a></li></ul></div><div class="widget"><div class="widget-title"> <i class="fa fa-you">友情链接</i></div><ul><li><a href="https://github.com/GYunZhi" title="GitHub" target="_blank">GitHub</a></li><li><a href="https://gitee.com/gongyz" title="Gitee" target="_blank">Gitee</a></li><li><a href="https://github.com/chaooo/hexo-theme-BlueLake/blob/master/README.md" title="BlueLake" target="_blank">BlueLake</a></li></ul></div></div></div></div><a id="totop" href="#top"></a><script type="text/javascript" src="/js/jquery.min.js"></script><script type="text/javascript" src="/js/love.js" charset="utf-8"></script><div id="footer"><div class="footer-info"><p><a href="/baidusitemap.xml">网站地图</a> | <a href="/atom.xml">订阅</a> | <a href="/about/">关于</a></p><p>Hi.第<i id="busuanzi_container_site_pv"></i><i id="busuanzi_value_site_pv"></i>个小伙伴</p><p class="statistics"></p><span id="since"></span><span class="myface">(●'◡'●)ﾉ♥</span><p></p><p></p><script>function show_date_time(){window.setTimeout("show_date_time()",1e3),BirthDay=new Date("02/15/2018 10:30:00"),today=new Date,timeold=today.getTime()-BirthDay.getTime(),sectimeold=timeold/1e3,secondsold=Math.floor(sectimeold),msPerDay=864e5,e_daysold=timeold/msPerDay,daysold=Math.floor(e_daysold),e_hrsold=24*(e_daysold-daysold),hrsold=Math.floor(e_hrsold),e_minsold=60*(e_hrsold-hrsold),minsold=Math.floor(60*(e_hrsold-hrsold)),seconds=Math.floor(60*(e_minsold-minsold)),since.innerHTML="博客已萌萌哒运行"+daysold+"天"+hrsold+"小时"+minsold+"分"+seconds+"秒"}show_date_time()</script><p> <span>Copyright &copy;<a href="/." rel="nofollow">GYunZhi.</a></span> <span>Theme by <a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake">BlueLake.</a></span> <span>Count by <a href="http://busuanzi.ibruce.info/">busuanzi.</a></span> <span>Powered by</span> <a rel="nofollow" target="_blank" href="https://hexo.io">Hexo.</a></p></div></div></div><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="//hm.baidu.com/hm.js?814d72806e475b8704164a120fe75726";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script type="text/javascript" src="/js/search.json.js?v=2.0.1"></script><script type="text/javascript" src="/js/toctotop.js?v=2.0.1" async></script><script>!function(e,t){var c,n=e.getElementsByTagName("body")[0];"function"!=typeof LivereTower&&((c=e.createElement("script")).src="https://cdn-city.livere.com/js/embed.dist.js",c.async=!0,n.appendChild(c))}(document)</script></body></html>